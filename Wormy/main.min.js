function Game(e){console.log("- game created");this.canvas=document.getElementById("gameCanvas");this.canvas2D=this.canvas.getContext("2d");this.FPS=5;this.paused=0;this.worm=e;this.intervalID=0;this.update=function(){this.worm.update(this.canvas)};this.draw=function(){this.canvas2D.clearRect(0,0,this.canvas.width,this.canvas.height);this.canvas2D.fillText("Use arrow keys/mouse click to move, press enter/return to pause",5,10);this.canvas2D.fillText("Developed by Behnam Azizi",this.canvas.width-150,this.canvas.height-10);this.worm.draw(this.canvas2D)};this.start=function(e){console.log("- game started");console.log("- FPS is "+this.FPS);this.handleKeys(e);e.intervalID=setInterval(function(){if(!e.paused){e.update();e.draw()}},1e3/this.FPS)};this.pause=function(){this.paused=1-this.paused;if(this.paused){console.log("- Game paused")}else{console.log("- Game resumed")}};this.handleKeys=function(e){e.canvas.addEventListener("mousedown",function(t){console.log("Mouse: ["+t.pageX+", "+t.pageY+"]");console.log("Wormy: ["+e.worm.head.x+", "+e.worm.head.y+"]");if(e.worm.head.dy!=0){if(t.pageX>e.worm.head.x){console.log("moveRight");e.worm.head.setDirection(e.worm.head.width,0)}else{console.log("moveLeft");e.worm.head.setDirection(-e.worm.head.width,0)}}else{if(t.pageY>e.worm.head.y){e.worm.head.setDirection(0,e.worm.head.height)}else{e.worm.head.setDirection(0,-e.worm.head.height)}}},false);KeyboardJS.on("up",function(){e.worm.head.setDirection(0,-e.worm.head.height)});KeyboardJS.on("down",function(){e.worm.head.setDirection(0,e.worm.head.height)});KeyboardJS.on("left",function(){e.worm.head.setDirection(-e.worm.head.width,0)});KeyboardJS.on("right",function(){e.worm.head.setDirection(e.worm.head.width,0)});KeyboardJS.on("enter",function(){e.pause()});console.log("- Key Handlers added")}}function Node(e){this.nextNode=e;this.width=20;this.height=20;this.x=100;this.y=100;this.prevX=this.x;this.prevY=this.y-this.height;if(e!=null){this.x=e.prevX;this.y=e.prevY}this.dx=0;this.dy=this.width;this.update=function(e,t){this.prevX=this.x;this.prevY=this.y;if(t){this.x+=this.dx;this.y+=this.dy}else{this.x=this.nextNode.prevX;this.y=this.nextNode.prevY}if(this.x<=0)this.x=0;else if(this.x>=e.width)this.x=e.width-this.width;if(this.y<=0)this.y=0;else if(this.y>=e.height)this.y=e.height-this.height};this.draw=function(e){if(this.nextNode==null){e.fillStyle="blue"}else{e.fillStyle="black"}e.fillRect(this.x,this.y,this.width,this.height)};this.getX=function(){return this.x};this.getY=function(){return this.y};this.setDirection=function(e,t){this.dx=e;this.dy=t}}function Worm(e){this.head=e[0];this.nodes=e;this.update=function(t){for(var n=0;n<this.nodes.length;n++){if(n==0)e[n].update(t,true);else e[n].update(t,false)}};this.draw=function(e){this.nodes.forEach(function(t){t.draw(e)})};this.push=function(e){this.nodes.push(e)}}window.onload=function(){window.onkeydown=function(e){var t=e.keyCode?e.keyCode:e.which;e.preventDefault()};console.clear();console.log("- window loaded");var e=[];for(var t=0;t<20;t++){if(t==0)e.push(new Node(null));else e.push(new Node(e[t-1]))}var n=new Worm(e);var r=new Game(n);r.start(r)}